<!-- === MathJax v3 Configuration for the Universal Number Set (UNS) === -->
<script>
(function() {
  // Detect user theme preference (light or dark)
  const darkMode = window.matchMedia &&
                   window.matchMedia('(prefers-color-scheme: dark)').matches;

  // Define theme-aware color palette
  const colors = darkMode ? {
    // Dark mode palette — high contrast on dark backgrounds
    novel: '#cbd5e1',      // light gray
    valid: '#60a5fa',      // blue-400
    invalid: '#f87171',    // red-400
    masked: '#c084fc',     // purple-400
    fused: '#34d399',      // green-400
    uncertain: '#fbbf24',  // amber-400
    stable: '#2dd4bf',     // teal-400
    unstable: '#fb7185'    // rose-400
  } : {
    // Light mode palette — accessible on white backgrounds
    novel: '#737373',      // neutral gray
    valid: '#3b82f6',      // blue-500
    invalid: '#ef4444',    // red-500
    masked: '#a855f7',     // purple-500
    fused: '#10b981',      // green-500
    uncertain: '#f59e0b',  // amber-500
    stable: '#14b8a6',     // teal-500
    unstable: '#e11d48'    // rose-600
  };

  window.MathJax = {
    tex: {
      inlineMath: [['\\(', '\\)']],
      displayMath: [['$$', '$$'], ['\\[', '\\]']],
      processEscapes: true,

      // --- UNS-specific macros with dynamic color ---
      macros: {
        // Foundational sets
        U: "\\mathbb{U}",
        R: "\\mathbb{R}",
        C: "\\mathbb{C}",
        N: "\\mathbb{N}",
        S: "\\mathbb{S}",

        // Core operators
        state: "\\psi",
        Uval: "\\operatorname{UVal}",
        Ustate: "\\operatorname{UState}",
        norm: "\\operatorname{NORM}",
        merge: "\\operatorname{MERGE}",
        mask: "\\operatorname{MASK}",
        lift: "\\operatorname{LIFT}",
        delta: "\\operatorname{DELTA}",
        mix: "\\operatorname{MIX}",
        dot: "\\operatorname{DOT}",
        dist: "\\operatorname{DIST}",
        fuse: "\\operatorname{FUSE}",
        expect: "\\operatorname{EXP}",
        range: "\\operatorname{RANGE}",
        amp: "\\operatorname{amp}",
        phase: "\\operatorname{phase}",

        // --- Color-coded semantic macros ---
        novel: `\\color{${colors.novel}}{\\textit{novel}}`,
        valid: `\\color{${colors.valid}}{\\text{valid}}`,
        invalid: `\\color{${colors.invalid}}{\\text{invalid}}`,
        masked: `\\color{${colors.masked}}{\\text{masked}}`,
        fused: `\\color{${colors.fused}}{\\text{fused}}`,
        uncertain: `\\color{${colors.uncertain}}{\\text{uncertain}}`,
        stable: `\\color{${colors.stable}}{\\text{stable}}`,
        unstable: `\\color{${colors.unstable}}{\\text{unstable}}`,

        // Utility and format macros
        expval: "\\langle #1 \\rangle",      // expectation ⟨x⟩
        conj: "\\overline{#1}",              // complex conjugate
        trans: "#1^{\\mathrm{T}}",           // transpose
        adj: "#1^{\\dagger}",                // adjoint
        abs: "\\left| #1 \\right|",          // magnitude
        normv: "\\left\\| #1 \\right\\|",    // norm
        prob: "\\mathcal{P}\\left( #1 \\right)", // probability operator

        // Transform and symbol helpers
        D: "\\operatorname{D}",
        F: "\\operatorname{F}",
        T: "\\operatorname{T}",
        Sigma: "\\Sigma",
        Omega: "\\Omega"
      }
    },
    options: {
      skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
  };
})();
</script>

<!-- Load MathJax v3 -->
<script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
