/* === UNS Theme for Minimal Mistakes === */
/* Version: Final Optimized Build */

/* -----------------------------
   ACCENT PALETTE
----------------------------- */

/* -- Light Mode (Default) -- */
:root {
  --uns-novel:     #737373;   /* neutral gray */
  --uns-valid:     #3b82f6;   /* blue-500 */
  --uns-invalid:   #ef4444;   /* red-500 */
  --uns-masked:    #a855f7;   /* purple-500 */
  --uns-fused:     #10b981;   /* green-500 */
  --uns-uncertain: #f59e0b;   /* amber-500 */
  --uns-stable:    #14b8a6;   /* teal-500 */
  --uns-unstable:  #e11d48;   /* rose-600 */
  --uns-highlight-bg: #f9fafb;
  --uns-inline-bg: #f3f4f6;
  --uns-inline-border: #e5e7eb;

  /* Future UNS code color hooks */
  --uns-keyword: var(--uns-valid);
  --uns-number:  var(--uns-stable);
  --uns-string:  var(--uns-invalid);
  --uns-comment: var(--uns-novel);
}

/* -- Dark Mode Overrides -- */
@media (prefers-color-scheme: dark) {
  :root {
    --uns-novel:     #cbd5e1;  /* light gray */
    --uns-valid:     #60a5fa;  /* blue-400 */
    --uns-invalid:   #f87171;  /* red-400 */
    --uns-masked:    #c084fc;  /* purple-400 */
    --uns-fused:     #34d399;  /* green-400 */
    --uns-uncertain: #fbbf24;  /* amber-400 */
    --uns-stable:    #2dd4bf;  /* teal-400 */
    --uns-unstable:  #fb7185;  /* rose-400 */
    --uns-highlight-bg: #1f2937;
    --uns-inline-bg: #374151;
    --uns-inline-border: #4b5563;
  }
}

/* -----------------------------
   MATHJAX + INLINE ELEMENTS
----------------------------- */

/* Inline math */
mjx-container[jax="CHTML"] {
  font-size: 1.02em;
  line-height: 1.4;
}

mjx-container[jax="CHTML"][display="inline"] {
  background-color: var(--uns-inline-bg);
  border-radius: 4px;
  padding: 0.05em 0.2em;
  border: 1px solid var(--uns-inline-border);
}

mjx-container[jax="CHTML"][display="true"] {
  margin: 1em 0;
  text-align: center;
}

/* Code and math visual harmony */
code, pre code {
  background-color: var(--uns-inline-bg);
  border-radius: 4px;
  border: 1px solid var(--uns-inline-border);
  color: var(--uns-stable);
}

/* Inline code emphasis (general) */
p code.highlighter-rouge,
li code.highlighter-rouge,
span code.highlighter-rouge {
  font-family: "Fira Code", "JetBrains Mono", Consolas, monospace;
  background-color: var(--uns-inline-bg) !important;
  color: var(--uns-stable) !important;
  border: 1px solid var(--uns-inline-border) !important;
  padding: 0.15em 0.3em;
  border-radius: 4px;
  font-size: 0.95em;
  transition: background-color 0.25s ease, color 0.25s ease;
}

/* -----------------------------
   UNS CALLS & CALLOUTS
----------------------------- */

.uns-term {
  display: inline-block;
  font-weight: 600;
  padding: 0.1em 0.4em;
  border-radius: 0.3em;
  color: #fff;
  background-color: var(--uns-fused);
}

.uns-term.invalid   { background-color: var(--uns-invalid); }
.uns-term.masked    { background-color: var(--uns-masked); }
.uns-term.uncertain { background-color: var(--uns-uncertain); }
.uns-term.stable    { background-color: var(--uns-stable); }
.uns-term.unstable  { background-color: var(--uns-unstable); }

blockquote {
  border-left: 4px solid var(--uns-fused);
  background-color: var(--uns-highlight-bg);
  color: inherit;
}

/* Links hover */
a:hover {
  color: var(--uns-fused);
}

/* Callout boxes */
.uns-callout {
  margin: 1.5em 0;
  padding: 1em 1.2em;
  border-left: 6px solid var(--uns-fused);
  border-radius: 0.5em;
  background-color: var(--uns-highlight-bg);
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.04);
  transition: background-color 0.25s ease, border-color 0.25s ease;
}

.uns-callout h4 {
  margin-top: 0;
  font-weight: 700;
}

.uns-callout--insight { border-left-color: var(--uns-fused); }
.uns-callout--insight h4 { color: var(--uns-fused); }

.uns-callout--warning {
  border-left-color: var(--uns-uncertain);
  background-color: rgba(245, 158, 11, 0.06);
}
.uns-callout--warning h4 { color: var(--uns-uncertain); }

.uns-callout--invalid {
  border-left-color: var(--uns-invalid);
  background-color: rgba(239, 68, 68, 0.05);
}
.uns-callout--invalid h4 { color: var(--uns-invalid); }

.uns-callout--stable {
  border-left-color: var(--uns-stable);
  background-color: rgba(20, 184, 166, 0.05);
}
.uns-callout--stable h4 { color: var(--uns-stable); }

.uns-callout--novel {
  border-left-color: var(--uns-novel);
  background-color: rgba(115, 115, 115, 0.05);
}
.uns-callout--novel h4 { color: var(--uns-novel); }

@media (prefers-color-scheme: dark) {
  .uns-callout {
    background-color: var(--uns-inline-bg);
    box-shadow: 0 0 0.5em rgba(0, 0, 0, 0.3);
  }
}

/* -----------------------------
   CODE BLOCKS (Unified Fix)
----------------------------- */

/* Base setup */
.highlight,
pre.highlight,
pre code {
  font-family: "Fira Code", "JetBrains Mono", Consolas, monospace;
  font-size: 0.95em;
  line-height: 1.65;
  border-radius: 8px;
  padding: 1em 1.2em;
  overflow-x: auto;
  border: 1px solid transparent;
  margin: 1em 0;
  transition: background-color 0.25s ease, color 0.25s ease, border-color 0.25s ease;
}

/* Rouge table reset */
.highlight > pre,
div.highlight,
figure.highlight,
.highlight table,
.highlight tr,
.highlight td {
  background: inherit !important;
  border: none !important;
  padding: 0;
  margin: 0;
}

/* Line number + code cell alignment */
.highlight pre,
.highlight td.code pre {
  white-space: pre-wrap;
  word-break: normal;
  tab-size: 4;
}

/* --- LIGHT MODE --- */
@media (prefers-color-scheme: light) {
  figure.highlight,
  div.highlight {
    background-color: #f9fafb !important;
    border: 1px solid #e5e7eb !important;
    border-radius: 8px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
  }

  .highlight pre,
  .highlight td.code pre {
    color: #1e293b !important;
  }

  /* Improved readability (WCAG contrast) */
  .highlight .c  { color: #4b5563; font-style: italic; } /* comments */
  .highlight .k  { color: #1d4ed8; font-weight: 600; }   /* keywords */
  .highlight .s  { color: #b91c1c; }                     /* strings */
  .highlight .mi,
  .highlight .mf { color: #059669; }                     /* numbers */
  .highlight .nb { color: #0f766e; }                     /* built-ins */
  .highlight .nf { color: #7c3aed; }                     /* functions */
  .highlight .o  { color: #111827; }                     /* operators */
  .highlight .p,
  .highlight .n  { color: #1e293b; }                     /* names */
}

/* --- DARK MODE --- */
@media (prefers-color-scheme: dark) {
  figure.highlight,
  div.highlight {
    background-color: #111827 !important;
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 8px;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.25);
  }

  .highlight pre,
  .highlight td.code pre {
    color: #f3f4f6 !important;
  }

  .highlight .c  { color: #6a9955; font-style: italic; }
  .highlight .k  { color: #569cd6; }
  .highlight .s  { color: #ce9178; }
  .highlight .mi,
  .highlight .mf { color: #b5cea8; }
  .highlight .nb { color: #4ec9b0; }
  .highlight .nf { color: #dcdcaa; }
  .highlight .o  { color: #d4d4d4; }
  .highlight .p,
  .highlight .n  { color: #e5e7eb; }
}

/* Scrollbar styling (Dark mode) */
@media (prefers-color-scheme: dark) {
  figure.highlight pre::-webkit-scrollbar {
    height: 0.5em;
  }
  figure.highlight pre::-webkit-scrollbar-thumb {
    background-color: rgba(255, 255, 255, 0.2);
    border-radius: 3px;
  }
  figure.highlight pre::-webkit-scrollbar-thumb:hover {
    background-color: rgba(255, 255, 255, 0.35);
  }
}

/* === FINAL PATCH: Fix Code Line Overlap in Rouge Tables === */

/* Normalize code block structure */
figure.highlight,
div.highlight,
.highlight table,
.highlight td,
.highlight pre,
.highlight code {
  line-height: 1.65 !important;     /* consistent vertical rhythm */
  vertical-align: top !important;
}

/* Force code content to flow line-by-line */
.highlight code {
  display: block !important;
  white-space: pre !important;
  overflow-wrap: normal !important;
  word-break: normal !important;
}

/* Handle nested <code> inside <td class="code"> specifically */
.highlight td.code pre code {
  display: inline-block !important; /* fixes extra blank lines */
  width: 100%;
  line-height: inherit;
}

/* Prevent table cell compression */
.highlight table td {
  padding: 0 !important;
  margin: 0 !important;
  border: none !important;
}

/* Guarantee consistent scrollbar alignment */
figure.highlight pre {
  display: block;
  margin: 0;
  padding: 1em 1.2em;
  line-height: inherit;
}
